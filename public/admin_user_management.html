<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EventHive - Admin Users Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="home_page.css">
    <link rel="stylesheet" href="admin_user_management.css">
    <link rel="icon" type="image/png" href="Logo.png">
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo-icon">
                <img src="Logo.png" alt="EventHive Logo" class="logo-img">
            </div>
            <h1>EventHive</h1>
        </div>

        <div class="nav-menu">
            <a href="admin_events.html" class="nav-item active">
                <i class="fas fa-calendar-check"></i>
                <span class="nav-text">Events</span>
            </a>
            <a href="admin_user_management.html" class="nav-item">
                <i class="fas fa-users"></i>
                <span class="nav-text">Users</span>
            </a>
            <a href="admin_inbox.html" class="nav-item">
                <i class="fas fa-envelope-open"></i>
                <span class="nav-text">Inbox</span>
            </a>
            <a href="home_page.html" class="nav-item">
                <i class="fas fa-sign-out-alt"></i>
                <span class="nav-text">Logout</span>
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <header class="admin-header"
            style="background: linear-gradient(rgba(22, 27, 51, 0.9), rgba(22, 27, 51, 0.9)), url('https://images.unsplash.com/photo-1531545514256-b1400bc00f31?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');">
            <div class="admin-header-content">
                <h2>User Management Dashboard</h2>
                <div class="admin-stats">
                    <div class="stat">
                        <i class="fas fa-users"></i>
                        <div>
                            <span class="stat-number">1,234</span>
                            <span class="stat-label">Total Users</span>
                        </div>
                    </div>
                    <div class="stat">
                        <i class="fas fa-user-tie"></i>
                        <div>
                            <span class="stat-number">89</span>
                            <span class="stat-label">Organizers</span>
                        </div>
                    </div>
                    <div class="stat">
                        <i class="fas fa-user-shield"></i>
                        <div>
                            <span class="stat-number">5</span>
                            <span class="stat-label">Admins</span>
                        </div>
                    </div>
                </div>

            </div>
        </header>

        <section class="section">
            <div class="search-bar">
                <input type="text" id="userSearch" placeholder="Search users..."
                    onkeypress="if(event.keyCode===13) handleSearch()">
                <button class="btn search-btn" onclick="handleSearch()">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <div class="users-container">
                <!-- User Card -->
                <div class="users-container" id="usersContainer">
                    <!-- User cards will be injected here by JavaScript -->
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer>
            <div class="footer-links">
                <a href="#">About Us</a>
                <a href="#">Contact</a>
                <a href="#">Terms of Service</a>
                <a href="#">Privacy Policy</a>
                <a href="#">Careers</a>
            </div>

            <div class="social-icons">
                <a href="#"><i class="fab fa-facebook-f"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-linkedin-in"></i></a>
            </div>

            <p>&copy; 2025 EventHive. All rights reserved. "Where Moments Become Memories"</p>
        </footer>
    </div>

    <script>
        // Search functionality
        function handleSearch() {
            const searchTerm = document.getElementById('userSearch').value.trim().toLowerCase();
            const users = document.querySelectorAll('.user-card');
            let foundMatch = false;

            // Reset all users first
            users.forEach(user => user.style.display = 'flex');

            if (searchTerm === '') return;

            users.forEach(user => {
                const userName = user.dataset.name.toLowerCase();
                if (!userName.includes(searchTerm)) {
                    user.style.display = 'none';
                } else {
                    foundMatch = true;
                    if (!document.querySelector('.highlight')) {
                        user.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        user.classList.add('highlight');
                        setTimeout(() => user.classList.remove('highlight'), 1500);
                    }
                }
            });

            if (!foundMatch) {
                alert(`No users found matching "${searchTerm}"`);
            }
        }

        // Event Listeners
        document.getElementById('userSearch').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                handleSearch();
            }
        });

        document.querySelector('.search-btn').addEventListener('click', handleSearch);
    </script>

    
    <script>
        // Save button functionality
            document.querySelectorAll('.btn-save').forEach(button => {
                button.addEventListener('click', () => {
                const userCard = button.closest('.user-card');
                const email = userCard.querySelector('p i.fa-envelope').parentElement.textContent.trim().split(' ')[1];
                const selectedRole = userCard.querySelector('.role-dropdown').value;

                fetch('/update-role', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, role: selectedRole })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Role updated successfully!');
                    } else {
                        alert('Failed to update role.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error occurred while updating role.');
                });
            });
        });
    </script>

    

    
    <script>
        // Load users from the server
        async function loadUsers() {
            try {
                const response = await fetch('/users');
                const users = await response.json();

                const container = document.getElementById('usersContainer');
                container.innerHTML = ''; // Clear any existing content

                users.forEach(user => {
                    const userCard = document.createElement('div');
                    userCard.className = 'user-card';
                    userCard.dataset.name = `${user.FirstName} ${user.LastName}`.toLowerCase();

                    userCard.innerHTML = `
                        <div class="user-info">
                            <div class="user-avatar">
                                <i class="fas fa-user-circle"></i>
                            </div>
                            <div class="user-details">
                                <h3>${user.FirstName} ${user.LastName}</h3>
                                <p><i class="fas fa-envelope"></i> ${user.Email}</p>
                                <p><i class="fas fa-birthday-cake"></i> ${user.Age} years</p>
                            </div>
                        </div>
                        <div class="user-actions">
                            <div class="role-select">
                                <label>Role:</label>
                                <select class="role-dropdown">
                                    <option value="client" ${user.Role === 'client' ? 'selected' : ''}>Client</option>
                                    <option value="organizer" ${user.Role === 'organizer' ? 'selected' : ''}>Organizer</option>
                                    <option value="admin" ${user.Role === 'admin' ? 'selected' : ''}>Admin</option>
                                </select>
                            </div>
                            <div class="action-buttons">
                                <button class="btn btn-save">
                                    <i class="fas fa-save"></i> Save
                                </button>
                                <button class="btn btn-danger">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                    `;

                    // Add save button functionality
                    const saveBtn = userCard.querySelector('.btn-save');
                    const dropdown = userCard.querySelector('.role-dropdown');

                    saveBtn.addEventListener('click', () => {
                        fetch('/update-role', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                email: user.Email,
                                role: dropdown.value
                            })
                        })
                        .then(res => res.json())
                        .then(data => {
                            if (data.success) {
                                alert('Role updated successfully!');
                            } else {
                                alert('Failed to update role.');
                            }
                        });
                    });

                    container.appendChild(userCard);

                    // Add delete button functionality
                    const deleteBtn = userCard.querySelector('.btn-danger');

                    deleteBtn.addEventListener('click', async () => {
                        if (confirm(`Are you sure you want to delete ${user.Email}?`)) {
                            const res = await fetch('/delete-user', {
                                method: 'DELETE',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ email: user.Email })
                            });

                            const data = await res.json();
                            if (data.success) {
                                alert('User deleted successfully!');
                                userCard.remove(); // Remove from the DOM
                            } else {
                                alert('Failed to delete user.');
                            }
                        }
                    });
                });
            } catch (err) {
                console.error('Failed to load users:', err);
            }
        }

        // Load users on page load
        window.addEventListener('DOMContentLoaded', loadUsers);
    </script>

</body>

</html>